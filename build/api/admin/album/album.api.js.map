{"version":3,"sources":["../../../../src/api/admin/album/album.api.js"],"names":["getAlbumList","req","res","limit","offset","status","name","type","query","filterName","Op","like","filterType","conditions","rows","count","Album","findAndCountAll","where","success","error","fail","message","createAlbum","body","createdBy","updatedBy","authUser","album","findOrCreate","defaults","getAlbumById","id","params","findOne","updateAlbumById","statusQuery","image","productionId","result","Production","attributes","data","update","deletedAlbumById"],"mappings":"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","file":"album.api.js","sourcesContent":["import Album from '../../../models/album';\nimport {Op} from '../../../common/sequelize-connection';\nimport Production from '../../../models/production';\n\nexport const getAlbumList = async (req, res) => {\n  try{\n    const {limit, offset, status, name, type} = req.query;\n    const filterName = name ? {name: { [Op.like]: `%${name}%` }} : {};\n    const filterType = type ? {type} : {};\n    const conditions = {...filterName, status, ...filterType};\n    const {rows, count} = await Album.findAndCountAll({where: conditions, offset, limit});\n    res.success(rows, {limit, offset, count});\n  } catch(error){\n    res.fail(error.message);\n  }\n};\n\nexport const createAlbum = async (req, res) => {\n  try{\n    const {name} = req.body;\n    const {createdBy, updatedBy} = req.authUser;\n    const [album] = await Album.findOrCreate({where: {name}, defaults: {...req.body, createdBy, updatedBy}});\n    res.success(album);\n  } catch(error){\n    res.fail(error.message);\n  }\n};\n\nexport const getAlbumById = async (req, res) => {\n  try{\n    const {id} = req.params;\n    const {status} = req.query;\n    const album = await Album.findOne({where: {id, status} });\n    res.success(album);\n  } catch(error){\n    res.fail(error.message);\n  }\n};\n\nexport const updateAlbumById = async (req, res) => {\n  try{\n    const {id} = req.params;\n    const statusQuery = req.query.status;\n    const { updatedBy } = req.authUser;\n    let {name, image, status, productionId, type} = req.body;\n    name = name ? {name} : {};\n    image = image ? {image} : {};\n    status = status ? {status} : {};\n\n    const result = productionId ? await Production.findOne({attributes: ['id'], where: {id: productionId}}) : true;\n    if(!result) return res.fail('Production Id is invalid.');\n\n    productionId = productionId ? {productionId} : {};\n    type = type ? {type} : {};\n    const data = {...name, ...image, ...status, ...productionId, updatedBy, ...type};\n    await Album.update(data, {where: {id, 'status': statusQuery}});\n    res.success('Successfully updated.');\n  } catch(error){\n    res.fail(error.message);\n  }\n};\n\nexport const deletedAlbumById = async (req, res) => {\n  try{\n    const {id} = req.params;\n    const { updatedBy } = req.authUser;\n    const [result] =  await Album.update({status: 'inactive', updatedBy}, {where: {id, status: 'active'}});\n    result === 0 ? res.fail('If is not found') : res.success('Successfully deleted.');\n  } catch(error){\n    res.fail(error.message);\n  }\n};\n"]}